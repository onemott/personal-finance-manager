<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCCIPC智能车实验室订单与账单管理系统</title>
    <meta name="description" content="SCCIPC智能车实验室财务管理系统，支持收支记录、订单管理、财务分析">
    <meta name="keywords" content="财务管理,记账,订单管理,个人理财">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    
    <!-- PWA 支持 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="财务管理">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <h1><i class="fa-solid fa-car"></i> SCCIPC智能车实验室订单与账单管理</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="showDataManagement()">
                    <i class="fa-solid fa-database"></i> 数据管理
                </button>
                <button class="btn btn-primary" onclick="exportData()">
                    <i class="fa-solid fa-download"></i> 导出数据
                </button>
                <button class="btn btn-success" onclick="showAddRecordModal()">
                    <i class="fa-solid fa-plus"></i> 新增记录
                </button>
            </div>
        </header>

        <!-- 财务概览 -->
        <div class="financial-overview">
            <div class="overview-card total-balance">
                <div class="card-icon">
                    <i class="fa-solid fa-piggy-bank"></i>
                </div>
                <div class="card-content">
                    <h3 id="totalBalance">¥0.00</h3>
                    <p>当前余额</p>
                    <small class="balance-trend" id="balanceTrend">本月变化: +¥0.00</small>
                </div>
            </div>
            
            <div class="overview-card total-income">
                <div class="card-icon">
                    <i class="fa-solid fa-arrow-up"></i>
                </div>
                <div class="card-content">
                    <h3 id="totalIncome">¥0.00</h3>
                    <p>总收入</p>
                    <small id="monthlyIncome">本月: +¥0.00</small>
                </div>
            </div>
            
            <div class="overview-card total-expense">
                <div class="card-icon">
                    <i class="fa-solid fa-arrow-down"></i>
                </div>
                <div class="card-content">
                    <h3 id="totalExpense">¥0.00</h3>
                    <p>总支出</p>
                    <small id="monthlyExpense">本月: -¥0.00</small>
                </div>
            </div>
            
            <div class="overview-card net-income">
                <div class="card-icon">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
                <div class="card-content">
                    <h3 id="netIncome">¥0.00</h3>
                    <p>净收入</p>
                    <small id="monthlyNet">本月: ¥0.00</small>
                </div>
            </div>
            
            <!-- 未报销发票（已开 + 可开） -->
            <div class="overview-card invoice-summary">
                <div class="card-icon">
                    <i class="fa-solid fa-file-invoice"></i>
                </div>
                <div class="card-content">
                    <h3 id="unreimbursedInvoiceAmount">¥0.00</h3>
                    <p>未报销发票</p>
                    <small id="unreimbursedBreakdown">已开: ¥0.00 | 可开: ¥0.00</small>
                </div>
            </div>

            <!-- 已报销发票 -->
            <div class="overview-card invoice-reimbursed">
                <div class="card-icon">
                    <i class="fa-solid fa-circle-check"></i>
                </div>
                <div class="card-content">
                    <h3 id="reimbursedInvoiceAmount">¥0.00</h3>
                    <p>已报销发票</p>
                    <small>累计已报销</small>
                </div>
            </div>
        </div>

        <!-- 筛选和搜索区域 -->
        <div class="filter-section">
            <div class="filter-tabs">
                <button class="tab-btn active" onclick="switchTab('all')" data-tab="all">
                    <i class="fa-solid fa-list"></i> 全部记录
                </button>
                <button class="tab-btn" onclick="switchTab('income')" data-tab="income">
                    <i class="fa-solid fa-circle-plus"></i> 收入记录
                </button>
                <button class="tab-btn" onclick="switchTab('expense')" data-tab="expense">
                    <i class="fa-solid fa-circle-minus"></i> 支出记录
                </button>
                <button class="tab-btn" onclick="switchTab('orders')" data-tab="orders">
                    <i class="fa-solid fa-cart-shopping"></i> 购物订单
                </button>
            </div>
            
            <div class="search-box">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="searchInput" placeholder="搜索描述、分类..." onkeyup="filterRecords()">
            </div>
            
            <div class="filters">
                <select id="categoryFilter" onchange="filterRecords()">
                    <option value="">全部分类</option>
                    <option value="salary">工资收入</option>
                    <option value="bonus">奖金</option>
                    <option value="investment">投资收益</option>
                    <option value="food">餐饮</option>
                    <option value="transport">交通</option>
                    <option value="shopping">购物</option>
                    <option value="entertainment">娱乐</option>
                    <option value="utilities">生活缴费</option>
                    <option value="healthcare">医疗</option>
                    <option value="education">教育</option>
                    <option value="other">其他</option>
                </select>

                <select id="dateFilter" onchange="filterRecords()">
                    <option value="">全部时间</option>
                    <option value="today">今天</option>
                    <option value="week">本周</option>
                    <option value="month">本月</option>
                    <option value="quarter">本季度</option>
                    <option value="year">本年</option>
                </select>

                <input type="date" id="startDate" onchange="filterRecords()">
                <input type="date" id="endDate" onchange="filterRecords()">
                
                <button class="btn btn-secondary" onclick="resetFilters()">
                    <i class="fa-solid fa-rotate-right"></i> 重置
                </button>
            </div>
        </div>

        <!-- 记录表格 -->
        <div class="table-section">
            <div class="table-header">
                <h2 id="tableTitle">全部记录</h2>
                <div class="table-actions">
                    <button class="btn btn-outline" onclick="selectAll()">
                        <i class="fa-solid fa-square-check"></i> 全选
                    </button>
                    <button class="btn btn-outline" onclick="deselectAll()">
                        <i class="fa-solid fa-square-xmark"></i> 取消全选
                    </button>

                    <button class="btn btn-outline" onclick="batchDelete()" id="batchDeleteBtn" disabled>
                        <i class="fa-solid fa-trash"></i> 批量删除
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"></th>
                            <th onclick="sortTable('date')">日期 <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('type')">类型 <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('category')">分类 <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('description')">描述 <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('amount')">金额 <i class="fa-solid fa-sort"></i></th>
                            <th onclick="sortTable('invoiceAmount')">发票金额 <i class="fa-solid fa-sort"></i></th>
                            <th>发票状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recordsTableBody">
                        <!-- 记录数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>

            <!-- 分页 -->
            <div class="pagination">
                <button class="btn btn-outline" onclick="changePage(-1)" id="prevBtn">
                    <i class="fa-solid fa-chevron-left"></i> 上一页
                </button>
                <span id="pageInfo">第 1 页，共 1 页</span>
                <button class="btn btn-outline" onclick="changePage(1)" id="nextBtn">
                    下一页 <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 记录详情模态框 -->
    <div id="recordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>记录详情</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body" id="recordDetails">
                <!-- 记录详情内容 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">关闭</button>
                <button class="btn btn-primary" onclick="editRecord()">编辑记录</button>
            </div>
        </div>
    </div>

    <!-- 新增/编辑记录模态框 -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="editModalTitle">新增记录</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editRecordForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>记录类型:</label>
                            <select id="editType" required onchange="updateCategoryOptions()">
                                <option value="income">收入</option>
                                <option value="expense">支出</option>
                                <option value="order">购物订单</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>分类:</label>
                            <select id="editCategory" required>
                                <!-- 动态生成选项 -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>描述:</label>
                        <input type="text" id="editDescription" required placeholder="请输入描述信息">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>金额:</label>
                            <input type="number" id="editAmount" step="0.01" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>发票金额:</label>
                            <input type="number" id="editInvoiceAmount" step="0.01" placeholder="0.00">
                            <small class="help-text">可开具发票的金额（用于报账）</small>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>日期:</label>
                            <input type="date" id="editDate" required>
                        </div>
                        <div class="form-group">
                            <label>发票状态:</label>
                            <select id="editInvoiceStatus">
                                <option value="none">无需发票</option>
                                <option value="available">可开发票</option>
                                <option value="issued">已开发票</option>
                                <option value="reimbursed">已报销</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>备注:</label>
                        <textarea id="editNotes" rows="3" placeholder="可选的备注信息"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditModal()">取消</button>
                <button class="btn btn-primary" onclick="saveRecord()">保存</button>
            </div>
        </div>
    </div>

    <!-- 数据管理模态框 -->
    <div id="dataManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fa-solid fa-database"></i> 数据管理</h3>
                <span class="close" onclick="closeDataManagementModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="data-management-section">
                    <h4><i class="fa-solid fa-circle-info"></i> 存储信息</h4>
                    <div class="storage-info" id="storageInfo">
                        <p>记录数量: <span id="storageRecordCount">0</span></p>
                        <p>存储大小: <span id="storageSize">0 KB</span></p>
                        <p>最后保存: <span id="lastSaved">未知</span></p>
                    </div>
                </div>

                <div class="data-management-section">
                    <h4><i class="fa-solid fa-upload"></i> 导入数据</h4>
                    <div class="import-section">
                        <div class="import-options">
                            <div class="import-option">
                                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">
                                <button class="btn btn-outline" onclick="document.getElementById('importFile').click()">
                                    <i class="fa-solid fa-file-code"></i> JSON数据文件
                                </button>
                                <p class="help-text">导入系统导出的JSON格式数据</p>
                            </div>
                            

                        </div>
                    </div>
                </div>

                <div class="data-management-section">
                    <h4><i class="fa-solid fa-download"></i> 导出数据</h4>
                    <div class="export-section">
                        <button class="btn btn-primary" onclick="exportDataAsJSON()">
                            <i class="fa-solid fa-file-code"></i> 导出为JSON
                        </button>
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="fa-solid fa-file-csv"></i> 导出为CSV
                        </button>
                        <p class="help-text">JSON格式可用于数据备份和恢复</p>
                    </div>
                </div>

                <div class="data-management-section">
                    <h4><i class="fa-solid fa-arrows-rotate"></i> 数据操作</h4>
                    <div class="data-operations">
                        <button class="btn btn-success" onclick="generateSampleData()">
                            <i class="fa-solid fa-circle-plus"></i> 生成示例数据
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            <i class="fa-solid fa-trash-can"></i> 清空所有数据
                        </button>
                        <p class="help-text">示例数据包含各种类型的收支记录</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDataManagementModal()">关闭</button>
            </div>
        </div>
    </div>

    <script src="script_final.js"></script>
</body>
</html>